<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HemaScan Pro - Settings</title>
    <link rel="stylesheet" href="common-styles.css">
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1 class="app-title">‚öôÔ∏è Settings</h1>
            <p class="app-subtitle">CONFIGURE YOUR APP</p>
        </div>

        <div class="content-section">
            <div class="section-title">üé® Display Settings</div>
            <div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Dark Mode</div>
                        <div style="font-size: 12px; color: #7a8ba9;">Enable clinical dark theme</div>
                    </div>
                    <div class="toggle-switch" id="darkModeToggle" onclick="toggleDarkMode()"></div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Show Cell Markers</div>
                        <div style="font-size: 12px; color: #7a8ba9;">Display detection circles</div>
                    </div>
                    <div class="toggle-switch active" id="markersToggle" onclick="toggleSetting('markers')"></div>
                </div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Show Statistics</div>
                        <div style="font-size: 12px; color: #7a8ba9;">Display real-time stats</div>
                    </div>
                    <div class="toggle-switch active" id="statsToggle" onclick="toggleSetting('stats')"></div>
                </div>
            </div>
        </div>

        <div class="content-section">
            <div class="section-title">üî¨ Detection Settings</div>
            <div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Sensitivity</div>
                        <div style="font-size: 12px; color: #7a8ba9;">Detection threshold level</div>
                    </div>
                    <div class="setting-value" id="sensitivityValue">75%</div>
                </div>
                <div style="padding: 0 15px;">
                    <input type="range" id="sensitivitySlider" min="0" max="100" value="75" 
                           style="width: 100%;" oninput="updateSensitivity(this.value)">
                </div>
                
                <div class="setting-item" style="margin-top: 15px;">
                    <div>
                        <div class="setting-label">Processing Interval</div>
                        <div style="font-size: 12px; color: #7a8ba9;">Frames per second</div>
                    </div>
                    <div class="setting-value" id="intervalValue">10 FPS</div>
                </div>
                <div style="padding: 0 15px;">
                    <input type="range" id="intervalSlider" min="1" max="30" value="10" 
                           style="width: 100%;" oninput="updateInterval(this.value)">
                </div>

                <div class="setting-item" style="margin-top: 15px;">
                    <div>
                        <div class="setting-label">Auto-Save</div>
                        <div style="font-size: 12px; color: #7a8ba9;">Automatically save results</div>
                    </div>
                    <div class="toggle-switch active" id="autoSaveToggle" onclick="toggleSetting('autoSave')"></div>
                </div>
            </div>
        </div>

        <div class="content-section">
            <div class="section-title">üì∑ Camera Settings</div>
            <div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Camera Quality</div>
                        <div style="font-size: 12px; color: #7a8ba9;">Video resolution</div>
                    </div>
                    <select id="qualitySelect" onchange="updateQuality(this.value)" 
                            style="padding: 8px 12px; border-radius: 8px; border: 1px solid #ddd; background: white;">
                        <option value="720">HD (720p)</option>
                        <option value="1080">Full HD (1080p)</option>
                        <option value="480">SD (480p)</option>
                    </select>
                </div>
                
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Flash Mode</div>
                        <div style="font-size: 12px; color: #7a8ba9;">Camera flash settings</div>
                    </div>
                    <select id="flashSelect" onchange="updateFlash(this.value)"
                            style="padding: 8px 12px; border-radius: 8px; border: 1px solid #ddd; background: white;">
                        <option value="off">Off</option>
                        <option value="on">On</option>
                        <option value="auto">Auto</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="content-section">
            <div class="section-title">üíæ Data Management</div>
            <div>
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Storage Used</div>
                        <div style="font-size: 12px; color: #7a8ba9;">Local data size</div>
                    </div>
                    <div class="setting-value" id="storageSize">0 KB</div>
                </div>
                
                <div class="setting-item">
                    <div>
                        <div class="setting-label">Total Readings</div>
                        <div style="font-size: 12px; color: #7a8ba9;">Saved analyses</div>
                    </div>
                    <div class="setting-value" id="totalReadings">0</div>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="action-btn primary" onclick="saveSettings()">
                üíæ Save Settings
            </button>
            <button class="action-btn" onclick="resetSettings()">
                üîÑ Reset to Default
            </button>
        </div>

        <div class="action-buttons">
            <button class="action-btn success" onclick="window.location.href='index.html'">
                üè† Home
            </button>
            <button class="action-btn danger" onclick="window.location.href='index.html'">
                ‚ùå Close
            </button>
        </div>
    </div>

    <script>
        let settings = {
            darkMode: false,
            markers: true,
            stats: true,
            sensitivity: 75,
            interval: 10,
            autoSave: true,
            quality: '720',
            flash: 'off'
        };

        function loadSettings() {
            const savedSettings = localStorage.getItem('hemaScanSettings');
            
            if (savedSettings) {
                settings = JSON.parse(savedSettings);
            }

            // Apply settings to UI
            if (settings.darkMode) {
                document.getElementById('darkModeToggle').classList.add('active');
                document.body.classList.add('dark-mode');
            }

            if (!settings.markers) {
                document.getElementById('markersToggle').classList.remove('active');
            }

            if (!settings.stats) {
                document.getElementById('statsToggle').classList.remove('active');
            }

            if (!settings.autoSave) {
                document.getElementById('autoSaveToggle').classList.remove('active');
            }

            document.getElementById('sensitivitySlider').value = settings.sensitivity;
            document.getElementById('sensitivityValue').textContent = settings.sensitivity + '%';

            document.getElementById('intervalSlider').value = settings.interval;
            document.getElementById('intervalValue').textContent = settings.interval + ' FPS';

            document.getElementById('qualitySelect').value = settings.quality;
            document.getElementById('flashSelect').value = settings.flash;

            // Load storage info
            loadStorageInfo();
        }

        function loadStorageInfo() {
            const savedData = localStorage.getItem('hemaScanData');
            
            if (savedData) {
                const data = JSON.parse(savedData);
                const sizeKB = (JSON.stringify(data).length / 1024).toFixed(2);
                document.getElementById('storageSize').textContent = sizeKB + ' KB';
                document.getElementById('totalReadings').textContent = (data.readings || []).length;
            } else {
                document.getElementById('storageSize').textContent = '0 KB';
                document.getElementById('totalReadings').textContent = '0';
            }
        }

        function toggleDarkMode() {
            settings.darkMode = !settings.darkMode;
            const toggle = document.getElementById('darkModeToggle');
            
            if (settings.darkMode) {
                toggle.classList.add('active');
                document.body.classList.add('dark-mode');
                localStorage.setItem('clinicalMode', 'true');
            } else {
                toggle.classList.remove('active');
                document.body.classList.remove('dark-mode');
                localStorage.setItem('clinicalMode', 'false');
            }
        }

        function toggleSetting(setting) {
            settings[setting] = !settings[setting];
            const toggle = document.getElementById(setting + 'Toggle');
            
            if (settings[setting]) {
                toggle.classList.add('active');
            } else {
                toggle.classList.remove('active');
            }
        }

        function updateSensitivity(value) {
            settings.sensitivity = parseInt(value);
            document.getElementById('sensitivityValue').textContent = value + '%';
        }

        function updateInterval(value) {
            settings.interval = parseInt(value);
            document.getElementById('intervalValue').textContent = value + ' FPS';
        }

        function updateQuality(value) {
            settings.quality = value;
        }

        function updateFlash(value) {
            settings.flash = value;
        }

        function saveSettings() {
            localStorage.setItem('hemaScanSettings', JSON.stringify(settings));
            alert('Settings saved successfully!');
        }

        function resetSettings() {
            if (confirm('Reset all settings to default values?')) {
                settings = {
                    darkMode: false,
                    markers: true,
                    stats: true,
                    sensitivity: 75,
                    interval: 10,
                    autoSave: true,
                    quality: '720',
                    flash: 'off'
                };

                localStorage.setItem('hemaScanSettings', JSON.stringify(settings));
                localStorage.setItem('clinicalMode', 'false');
                
                alert('Settings reset to default!');
                location.reload();
            }
        }

        function checkClinicalMode() {
            const clinicalMode = localStorage.getItem('clinicalMode') === 'true';
            if (clinicalMode) {
                settings.darkMode = true;
                document.body.classList.add('dark-mode');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkClinicalMode();
            loadSettings();
        });
    </script>
</body>
</html>
